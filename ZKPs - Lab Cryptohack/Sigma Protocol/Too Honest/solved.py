# # import os, random, pwn, json
# # from Crypto.Util.number import bytes_to_long

# # N = 63506177426384102189597350894327047299059434133653566917776601666605133716653510828029111986956978773016660313963972378811186153674164948861199369871734498221215139927864142313488277305751745855210473314367642273303159704466900274761354992859789827863358153922459760984397971477173435625199596782211170294424560686178858124003120741008270927463303483018910205943877584647744143454984243979284973117132536957364157878132874844783228762221620863204335896952103079109039534346621267709606103312376393511653638269034043434410564414042523141936372609708140474052147124354400977541403247799192906955295291389109531010594317
# # g = 2
# # k1 = 512
# # k2 = 128
# # S = 2**k1
# # R = 2**(2*k2+k1)

# # f = pwn.connect("socket.cryptohack.org", 13429, level = 'debug')
# # f.recvline()
# # msg = json.loads(f.recvline().decode())
# # y = msg["y"]
# # a = msg["a"]
# # f.sendline(json.dumps({"e": 1}))
# # z = json.loads(f.recvline().decode())["z"]
# # f.close()



# from pwn import *
# import json
# from Crypto.Util.number import long_to_bytes, inverse

# # Thông tin kết nối
# HOST = 'socket.cryptohack.org'
# PORT = 13429

# # Kết nối lần 1 đến server
# f1 = connect(HOST, PORT, level='debug')
# f1.recvline()  # Nhận thông điệp đầu tiên từ server
# msg1 = json.loads(f1.recvline().decode())
# y = msg1["y"]
# a = msg1["a"]

# # Giả lập thử thách e1
# e1 = 1
# f1.sendline(json.dumps({"e": e1}))
# z1 = json.loads(f1.recvline().decode())["z"]
# f1.close()

# # Kết nối lần 2 đến server
# f2 = connect(HOST, PORT, level='debug')
# f2.recvline()  # Nhận thông điệp đầu tiên từ server
# msg2 = json.loads(f2.recvline().decode())
# y = msg2["y"]
# a = msg2["a"]

# # Giả lập thử thách e2
# e2 = 2
# f2.sendline(json.dumps({"e": e2}))
# z2 = json.loads(f2.recvline().decode())["z"]
# f2.close()

# # Tính toán flag
# N = 63506177426384102189597350894327047299059434133653566917776601666605133716653510828029111986956978773016660313963972378811186153674164948861199369871734498221215139927864142313488277305751745855210473314367642273303159704466900274761354992859789827863358153922459760984397971477173435625199596782211170294424560686178858124003120741008270927463303483018910205943877584647744143454984243979284973117132536957364157878132874844783228762221620863204335896952103079109039534346621267709606103312376393511653638269034043434410564414042523141936372609708140474052147124354400977541403247799192906955295291389109531010594317

# flag = (z1 - z2) * inverse(e1 - e2, N) % N
# flag_bytes = long_to_bytes(flag)
# print(f"Flag: {flag_bytes}")



from pwn import *
import json
from Crypto.Util.number import long_to_bytes, inverse

# Thông tin kết nối
HOST = 'socket.cryptohack.org'
PORT = 13429

def connect_and_get_data(e):
    conn = connect(HOST, PORT, level='debug')
    

    conn.recvline()  
    msg = json.loads(conn.recvline().decode())
    y = msg["y"]
    a = msg["a"]

    conn.sendline(json.dumps({"e": e}))
    response = json.loads(conn.recvline().decode())
    z = response["z"]
    conn.close()
    return y, a, z

e1 = 1  
y1, a1, z1 = connect_and_get_data(e1)

e2 = 2  
y2, a2, z2 = connect_and_get_data(e2)

N = 63506177426384102189597350894327047299059434133653566917776601666605133716653510828029111986956978773016660313963972378811186153674164948861199369871734498221215139927864142313488277305751745855210473314367642273303159704466900274761354992859789827863358153922459760984397971477173435625199596782211170294424560686178858124003120741008270927463303483018910205943877584647744143454984243979284973117132536957364157878132874844783228762221620863204335896952103079109039534346621267709606103312376393511653638269034043434410564414042523141936372609708140474052147124354400977541403247799192906955295291389109531010594317

flag = (z1 - z2) * inverse(e1 - e2, N) % N
flag_bytes = long_to_bytes(flag)

print(f"Flag: {flag_bytes}")
